
library(devtools)
#install_github('cloudyr/MTurkR',force=T)
require('MTurkR')


library(dplyr)


Sys.setenv(AWS_ACCESS_KEY_ID = read.csv('../../../TScott/mturk/credentials.csv',stringsAsFactors = F)[,2],
           AWS_SECRET_ACCESS_KEY = read.csv('../../../TScott/mturk/credentials.csv',stringsAsFactors = F)[,3])
AccountBalance()

dat <- read.csv('code/plan_goals.csv',stringsAsFactors=F)
library(googlesheets)
dat = read.csv('https://docs.google.com/spreadsheets/d/1xNbRL31keNT59yhr-43xUqLoaAkvdGT4rMAYCIKCS18/pub?output=csv')
h1 = status(annotation = 'full_nb_7-18')
h2 = status(annotation='full_nb_2')
h3 = status(annotation = 'full_nb_add6')


hitid_first74 = c("3THR0FZ95PUUAL4K14NX27HVW9FLOL", "37G6BXQPLQMJPR78ZVSXEHMB2DWEQZ",
 "32204AGAABD4WC4WM0VR56FMO6FHGN", "3L21G7IH47XTES4IEHECKJ6JCD91Y6",
 "3J9UN9O9J3T3CEO1WY99WR8LUHUJ0R", "3LG268AV387J1SM8CAHXJ7WGYZYER0",
 "3L60IFZKF3JIW8Z766D9Q6RN36SHHM", "3LN50BUKPVCCVLGLG40CR7ML6EBLP2",
 "33N1S8XHHMMTJIENA3GVYQFLI7D1ZX", "3UQVX1UPFSI36IQTPD3HXAM4S6820N",
 "3IVEC1GSLP03J39JSHD9AWRVZ90J1U", "3LCXHSGDLT7V27MLRZH29H1CK1HESO",
 "307FVKVSYRGRR750EQ7E54TPKYA47L", "32TMVRKDGNZVRLAJOVZKJ4PKVIG488",
 "30EV7DWJTVWOLE5FKNQTFFX0KOP6Y9", "3TCFMTM8HEP3D7BBLW7HBF5EXYE21Q",
 "37VUR2VJ6AQGBP3DIPWNNSE09PRC19", "3R15W654VDUXVXH0GHF1RCCVBAXLQT",
 "3421H3BM9AIL88CEWUS2P29EXLO9JT", "3TFJJUELSHQN0AL91TW1SBO51V5C2Q",
 "3O0M2G5VC63V5QTTTN5YJ0KVFOY49X", "3H781YYV6TJWH7Z0GZMSJMXYMKVETD",
 "3V0TR1NRVA39A93YLTJYFVVFL6G4AC", "3V7ICJJAZAHETJ8QR7JUA6FL3O14B7",
 "3CIS7GGG65KBHKEPG4C2OIJ05Y2EU4", "3D4BBDG7ZHXCLSHS5TA6BLTX795C31",
 "3IZVJEBJ6ALOQ4FKG9SCTM62QIT6Z0", "32W3UF2EZOMX3O0W57FPLQL3L91C4M",
 "36KM3FWE3RDASJNZVPKCT13C3MU708", "3N2YPY1GI6ZBUZ3PLUM7K4LJJ5BEVT",
 "3FW4EL5A3LPA2ST7407VGYFJP4S227", "3566S7OX5DKAZ88HR8OC76MM8E071B",
 "32W3UF2EZOMX3O0W57FPLQL3L914CE", "378G7J1SJLZO9O3UB4R3664XQEDEW3",
 "34F34TZU7W0A8ORFBLDNFF10RFEJ2B", "3I7KR83SNAEGJSIWEFSEQH9RCAO9KS",
 "3UOMW19E6D7FZ74WJCYZQIRHL5WC5R", "3DQYSJDTYLC3YO8KL9NP8PI4ZGJEXW",
 "3V8JSVE8YYRSYTYUQ59RR3PD1MDEY2", "3DTJ4WT8BDGS3J8ZMRBA5AYF7GHEZT",
 "3M7OI89LVYPBIB4AOV84IO5HH07C67", "3ZLW647WALWZNAPQ80L0Z8KBVIS23I",
 "3NQUW096N69R3Y0EZF4F5HM61AT9LV", "3RHLQY6EDT578G6A53A05W3L69D4DE",
 "360ZO6N6J1KB9GIZZR5U5U1V1FJ9MX", "3O4VWC1GEW7ZT6NYFLRSYP6SXTEJ3M",
 "3087LXLJ6MHN7C25D8IOHTGT1ADF0K", "3DWNFENNE3WKB262FZWB8UYYBTAJ47",
 "3511RHPADVFX7YW0TW41W2M07WZLRU", "3RQVKZ7ZRKKHOTQDACOQCPWR0KE72S",
 "35XW21VSVGF98DWD8L46MCRWTYILSI", "3P6ENY9P79XIS3ARCOVUQIS23J7HIF",
 "3G5RUKN2EC4HRY3ZBSKUI9QV65T9NX", "3CZH926SICFC0MKA1YLKBEL66LE4E7",
 "3ZURAPD288ONE1NN9RMOVYZ362JF1N", "3PKJ68EHDNXENEUXU6GU2J72GYWHJR",
 "35O6H0UNLSH27LA2T4FLDM4CBP5J5C", "3ODOP6T3ASLK568U8EQJ9DCH9IO243",
 "31S7M7DAGGRAND9SXL9WWHNIVHWLT7", "359AP8GAGGLUMBIF75DWO25DCBRC76",
 "3X7837UUADZYQPAGYNPQ5SIC7KGJ6S", "37VHPF5VYC4YMPNYHA522218NVXC8T",
 "3W3RSPVVGSSPNQOHXQZ61D9KEV3LUY", "3UV0D2KX1MK460K6W95QTW66IMT4FP",
 "3BFNCI9LYKR69BMWEC2VVZ1J6YE733", "3T2HW4QDUV8Y0U68M2BG2YWJ71FC9I",
 "3G9UA71JVVVHUPOLHXUIB6I82V0J7R", "3QE4DGPGBRCAK0G17TB8BH6IJ1T4GO",
 "3IV1AEQ4DRELU3T4R2MOP6E3DF6J8E", "302OLP89DZ8C5DGDE8PGYT73DJXCAX",
 "309D674SHZMHONL5KMPCT4R9V1ICBS", "307FVKVSYRGRR750EQ7E54TPKYA74O",
 "33P2GD6NRNT9YY0FCRG63Y7FVNWHKQ", "3SZYX62S5G19NQ90SVQOAWZ3KU575T")
##Last 4
hitid_last4 = c("3A9LA2FRWSFFIYZMBAVVTSFHRWCHXG", "3K2CEDRACB2UTVRDXXABWU27VMNMTB",
 "38XPGNCKHT1T2X6WWOAUBI9S6GIV45", "30P8I9JKOIMBYGAWATT4GAF66CDV5A")

hit_ref = data.frame(hitIDs = c(hitid_first74,hitid_last4,
                               # h1$HITId,
                                h3$HITId),
                     whichQ = c(1:78,
                               # 1:11,
                                1:78))

#a1 = GetAssignments(annotation = 'full_nb_7-18')
a2 = GetAssignments(annotation = 'full_nb_2')
a3 = GetAssignments(annotation = 'full_nb_add6')
#a1$Q_ID =  hit_ref$whichQ[match(a1$HITId,hit_ref$hitIDs)]
a2$Q_ID =  hit_ref$whichQ[match(a2$HITId,hit_ref$hitIDs)]
a3$Q_ID =  hit_ref$whichQ[match(a3$HITId,hit_ref$hitIDs)]

#a_all = plyr::join_all(list(a1,a2,a3),type='full')
a_all = plyr::join_all(list(a2,a3),type='full')
a_all$Council = dat$Council[a_all$Q_ID]
a_all$Coded = dat$Statement_Type[a_all$Q_ID]


te = a_all %>% group_by(Q_ID,Council,Coded) %>% summarise(prop_yes = sum(Category=='YES it does')/n())

ggplot(te,aes(x=Council,y = prop_yes,colour = Coded)) + #geom_point()  +
  geom_label(aes(label=Q_ID))
  geom_point()

dat$Wording[46]
dat %>% filter(Council=='SUO')
tapply(te$prop_yes,te$Council,mean)

h1$uq = 1:nrow(h1)
h2$uq = 1:nrow(h2)
h3$uq = 1:nrow(h3)

dat = dat %>% group_by(Council,Goal) %>% 
  mutate(Score = sum(Defined_Direction,Measurable_Outcome,Specified_Action))

library(knitr)

temp = 
  
  dat %>% group_by(Council) %>% 
  mutate(Good = ifelse(Score>1.5,1,0)) %>% summarise(Avg = mean(Good))
  
  
  summarise(Avg = mean(Score))

kable(cbind(table(dat$Council,dat$Score),round(temp$Avg,2)))
    
      




as.data.frame(tapply(dat$Score,dat$Council,mean))

  
  geom_dotplot() + facet_wrap(~Council)

which(h2$HITId=='30P8I9JKOIMBYGAWATT4GAF66CDV5A')
